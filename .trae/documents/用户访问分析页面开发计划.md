## 项目概述
基于现有的Next.js + React + TypeScript + Tailwind CSS + Prisma/Supabase技术栈，开发一个完整的用户访问分析页面。

## 技术栈确认
- **框架**: Next.js 16 + React 19
- **语言**: TypeScript
- **样式**: Tailwind CSS 4 + shadcn/ui组件
- **图表库**: 需要安装 Recharts
- **数据库**: Prisma + PostgreSQL/Supabase
- **UI组件**: 已存在card, tabs, select, button, table, badge等

## 实施步骤

### 第一阶段：数据库模型扩展
1. **扩展Prisma Schema**
   - 添加 `UserVisit` 模型（访问记录）
   - 添加 `UserSession` 模型（会话追踪）
   - 添加 `PageView` 模型（页面浏览）
   - 运行 `prisma migrate` 更新数据库

### 第二阶段：API接口开发
2. **创建API路由** `src/app/api/admin/analytics/route.ts`
   - GET /api/admin/analytics - 获取综合统计数据
   - 支持时间范围筛选（今日/昨日/近7天/近30天/自定义）
   - 支持用户角色、访问来源筛选
   - 返回：访问量、地域分布、设备类型、用户行为、热门页面、新老用户占比、留存率

3. **创建数据导出API** `src/app/api/admin/analytics/export/route.ts`
   - 支持CSV和Excel格式导出

### 第三阶段：前端组件开发
4. **安装依赖**
   - `recharts` - 图表库
   - `xlsx` - Excel导出

5. **创建分析组件** `src/components/admin/analytics/`
   - `AnalyticsDashboard.tsx` - 主容器组件
   - `FilterBar.tsx` - 筛选栏（时间范围、用户角色、访问来源）
   - `StatCards.tsx` - 关键指标卡片（总访问量、独立访客、平均停留时长、跳出率）
   - `VisitTrendChart.tsx` - 访问量趋势折线图（日/周/月/年）
   - `GeoDistributionMap.tsx` - 地域分布热力图/柱状图
   - `DeviceChart.tsx` - 设备类型饼图/环形图
   - `UserBehaviorChart.tsx` - 用户行为路径桑基图/流程图
   - `TopPagesTable.tsx` - 热门页面排行表格
   - `UserTypeChart.tsx` - 新老用户占比饼图
   - `RetentionChart.tsx` - 用户留存率折线图
   - `ExportButton.tsx` - 数据导出按钮

### 第四阶段：页面集成
6. **创建分析页面** `src/app/admin/analytics/page.tsx`
   - 复用现有后台布局（header + tabs）
   - 在dashboard的Tabs中添加"访问分析"选项卡
   - 实现数据自动刷新机制（每30秒）
   - 添加加载状态和错误处理

### 第五阶段：样式与响应式
7. **响应式布局**
   - 大屏（≥1280px）：4列网格布局
   - 中屏（≥768px）：2列网格布局
   - 小屏（<768px）：单列布局
   - 图表自适应容器大小

### 第六阶段：测试与优化
8. **功能测试**
   - 筛选功能测试
   - 数据导出测试
   - 响应式布局测试
   - 实时更新测试

## 文件结构
```
src/
├── app/
│   ├── admin/
│   │   ├── analytics/
│   │   │   └── page.tsx          # 分析页面
│   │   └── dashboard/
│   │       └── page.tsx          # 更新：添加访问分析Tab
│   └── api/
│       └── admin/
│           └── analytics/
│               ├── route.ts      # 统计数据API
│               └── export/
│                   └── route.ts  # 导出API
├── components/
│   └── admin/
│       └── analytics/
│           ├── AnalyticsDashboard.tsx
│           ├── FilterBar.tsx
│           ├── StatCards.tsx
│           ├── VisitTrendChart.tsx
│           ├── GeoDistributionMap.tsx
│           ├── DeviceChart.tsx
│           ├── UserBehaviorChart.tsx
│           ├── TopPagesTable.tsx
│           ├── UserTypeChart.tsx
│           ├── RetentionChart.tsx
│           └── ExportButton.tsx
└── lib/
    └── analytics-utils.ts        # 分析数据工具函数
```

## 核心功能模块

### 1. 筛选功能
- 时间范围：今日、昨日、近7天、近30天、自定义日期
- 用户角色：全部、管理员、普通用户、访客
- 访问来源：全部、直接访问、搜索引擎、社交媒体、外部链接

### 2. 数据可视化
- **折线图**：访问量趋势、留存率趋势
- **饼图/环形图**：设备类型分布、新老用户占比
- **柱状图**：地域分布TOP10
- **表格**：热门页面排行（页面路径、浏览量、平均停留时间）
- **桑基图**：用户行为路径（可选）

### 3. 数据导出
- CSV格式：纯文本，兼容性好
- Excel格式：带样式，适合进一步分析

### 4. 实时更新
- 自动刷新：每30秒轮询一次
- 手动刷新：提供刷新按钮
- 最后更新时间显示

## UI设计规范
- 沿用现有后台风格：白色卡片、灰色背景、圆角边框
- 使用现有UI组件：Card, Tabs, Select, Button, Table, Badge
- 配色方案：主色调与现有系统保持一致
- 图表配色：使用Tailwind CSS颜色变量

请确认此计划后，我将开始实施开发。